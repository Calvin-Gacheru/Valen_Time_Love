<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* CSS: The Visuals */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            /* Animated Gradient */
            background: linear-gradient(-45deg,#ee9ca7,#ff9a9e, #fad0c4, #ffdde1, #ff512f, #dd2476, #ff00cc, #6a11cb);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* The Container */
        .phone-container {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            width: 90%; 
            max-width: 400px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            position: relative;
        }

        /* Password Gate Styles */
        #password-gate { 
            text-align: center; 
            color: white; 
        }

        input[type="password"] { 
            padding: 10px; 
            border-radius: 5px; 
            border: none; 
            margin-bottom: 10px; 
            width: 80%; 
        }

        button.unlock-btn { 
            font-family:Arial, Helvetica, sans-serif;
            letter-spacing: 1px;
            background: #ff4b4b; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1em;
        }

        /* Quiz UI */
        .score-board { 
            font-family:Arial, Helvetica, sans-serif;
            letter-spacing: 1px;
            /* Make Italic and add a subtle shadow for a dreamy effect */
            font-style: italic;
            text-shadow: 1px 1px 2px rgba(106, 17, 203, 0.3);
            background: #fff; 
            color: #6a11cb; 
            padding: 10px; 
            border-radius: 10px; 
            text-align: center; 
            font-weight: bold; 
            margin-bottom: 15px; 
        }
        .card { 
            /* New styles for the card container */
            background: rgba(255, 255, 255, 0.85); /* 85% opacity white */
            backdrop-filter: blur(10px);            /* The blur magic */
            border: 1px solid rgba(255, 255, 255, 0.5); /* Subtle white border */

            background: rgba(255, 255, 255, 0.4); /* 65% opacity white */
            padding: 20px; 
            border-radius: 30px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 

            /* Moving button styles */
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative; }
        
        #quiz-container { display: none; flex-direction: column; }
        .question-text { font-size: 1.1em; margin-bottom: 20px; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .option-btn { background: #f0f0f0; border: 1px solid #ddd; padding: 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
        .option-btn:hover { background: #e0e0e0; }

        /* Proposal Styles */
        #proposal-container { 
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            font-family: 'Pacifico', cursive;
            letter-spacing: 1px;
            display: none; 
            flex-direction: column;
            justify-content: center;
            position: relative;}
        .btn-group { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 10px 10px rgba(40, 167, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        .yes-btn { 
            font-family:Arial, Helvetica, sans-serif;
            letter-spacing: 0.5px;
            background-color: #32cd32; 
            color: white; 
            padding: 15px 40px; 
            border: none; 
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.3em; 
            animation: pulse 2s infinite;
        }

        .no-btn { 
            font-family: Arial, Helvetica, sans-serif;
            letter-spacing: 1px;
            background-color: #ff3b3b; 
            color: white; 
            padding: 15px 40px; 
            border: none; 
            border-radius: 50px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 1.3em; 
            transition: all 0.3s ease; 
        }

        /* Success Styles */
        #success-container { display: none; flex-direction: column; }

        /* Error Popups */
        .overlay-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            text-align: center;
            display: none;
            z-index: 100;
            width: 80%;
            max-width: 300px;
        }
        .heart-popup { font-size: 50px; color: red; animation: pop 0.6s ease-out, float-heart 1.6s ease-in-out infinite; }
        .hurt-popup { font-size: 50px; animation: shake 0.6s ease-in-out, wobble 1.2s ease-in-out; }

        #system-error-overlay {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d2d2d;
            color: #ff4b4b;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ff4b4b;
            text-align: center;
            display: none;
            z-index: 200;
            width: 85%;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        @keyframes pop { 0% { transform: scale(0); } 70% { transform: scale(1.15); } 100% { transform: scale(1); } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-6px); } 50% { transform: translateX(6px); } 75% { transform: translateX(-6px); } 100% { transform: translateX(0); } }
        @keyframes float-heart { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes wobble { 0% { transform: rotate(0deg); } 25% { transform: rotate(-6deg); } 50% { transform: rotate(6deg); } 75% { transform: rotate(-4deg); } 100% { transform: rotate(0deg); } }
        @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.05); } 30% { transform: scale(1); } 45% { transform: scale(1.05); } 60% { transform: scale(1); } 100% { transform: scale(1); } }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #success-container .card { animation: heartbeat 1.5s infinite; }

        /* Heart Confetti */
        #heart-confetti {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 300;
        }
        .confetti-heart {
            position: absolute;
            top: -10%;
            font-size: 22px;
            opacity: 0.9;
            animation: fall-heart 6s linear forwards;
            text-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        @keyframes fall-heart {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }
        /* Floating Background Hearts */
        .circles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
            z-index: -1; /* Puts them BEHIND the game */
        }

        .circles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            font-size: bold; /* Size of the heart emoji */
            color: rgba(255, 255, 255, 0.7); /* Subtle white text/emojis */
            bottom: -150px;
            animation: animate 25s linear infinite;
            white-space: nowrap; /* Keep "I Love You" on one line */
            text-shadow: 0 0 25px rgba(0,0,0,0.2);
        }

        /* LAYER 1 SPECIFIC: The Giants (Only applies to the first list) */
        #bg-layer-1 li:nth-child(1){ left: 25%; font-size: 80px; animation-delay: 0s; }
        #bg-layer-1 li:nth-child(2){ left: 10%; font-size: 40px; animation-delay: 2s; animation-duration: 12s; }
        #bg-layer-1 li:nth-child(3){ left: 70%; font-size: 40px; animation-delay: 4s; }
        #bg-layer-1 li:nth-child(4){ left: 40%; font-size: 100px; animation-delay: 0s; animation-duration: 18s; }
        #bg-layer-1 li:nth-child(5){ left: 65%; font-size: 40px; animation-delay: 0s; }
        #bg-layer-1 li:nth-child(6){ left: 75%; font-size: 150px; animation-delay: 3s; }
        #bg-layer-1 li:nth-child(7){ left: 35%; font-size: 200px; animation-delay: 7s; }
        #bg-layer-1 li:nth-child(8){ left: 50%; font-size: 50px; animation-delay: 15s; animation-duration: 45s; }
        #bg-layer-1 li:nth-child(9){ left: 20%; font-size: 30px; animation-delay: 2s; animation-duration: 35s; }
        #bg-layer-1 li:nth-child(10){ left: 85%; font-size: 180px; animation-delay: 0s; animation-duration: 11s; }
        
        /* LAYER 2 SPECIFIC: Text Styling */
        #bg-layer-2 li {
            width: auto; height: auto;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            font-family: sans-serif;
        }
        
        /* Float Up Animation */
        @keyframes animate {
            0%{ transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 0; }
            100%{ transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; }
        }

        /* Randomize the hearts */
        .circles li:nth-child(1){ left: 25%; font-size: 80px; animation-delay: 0s; }
        .circles li:nth-child(2){ left: 10%; font-size: 40px; animation-delay: 2s; animation-duration: 12s; }
        .circles li:nth-child(3){ left: 70%; font-size: 40px; animation-delay: 4s; }
        .circles li:nth-child(4){ left: 40%; font-size: 100px; animation-delay: 0s; animation-duration: 18s; }
        .circles li:nth-child(5){ left: 65%; font-size: 40px; animation-delay: 0s; } 
        .circles li:nth-child(6){ left: 75%; font-size: 150px; animation-delay: 3s; } /* HUGE */
        .circles li:nth-child(7){ left: 35%; font-size: 200px; animation-delay: 7s; } /* GIGANTIC */
        .circles li:nth-child(8){ left: 50%; font-size: 50px; animation-delay: 15s; animation-duration: 45s; }
        .circles li:nth-child(9){ left: 20%; font-size: 30px; animation-delay: 2s; animation-duration: 35s; }
        .circles li:nth-child(10){ left: 85%; font-size: 180px; animation-delay: 0s; animation-duration: 11s; }
        .circles li:nth-child(11){ left: 5%; font-size: 90px; animation-delay: 5s; }
        .circles li:nth-child(12){ left: 55%; font-size: 60px; animation-delay: 8s; }
        .circles li:nth-child(13){ left: 90%; font-size: 120px; animation-delay: 1s; }
        .circles li:nth-child(14){ left: 15%; font-size: 70px; animation-delay: 6s; }
        .circles li:nth-child(15){ left: 60%; font-size: 50px; animation-delay: 9s; } 
    
        /* Success Styles */
        #success-container .card { 
            /* 1. Make it much more see-through (0.4 Opacity) */
            background: rgba(255, 255, 255, 0.4);
            
            /* 2. Increase the blur so text is still readable */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px); /* For Safari */
            
            /* 3. Make the border subtler */
            border: 1px solid rgba(255, 255, 255, 0.3);
            
            /* 4. Add a white glow so it looks like it's shining */
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            
            /* 5. Ensure text color is strong enough to read */
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);

        }
        /* Restart Button */
        .restart-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.6);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-family: 'Poppins', sans-serif;
            transition: background 0.3s;
        }

        .restart-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

    </style>
</head>
<body>
    <ul class="circles" id="bg-layer-1">
        <li>‚ù§Ô∏è</li> <li>üíñ</li> <li>ü§ç</li> <li>üíò</li> <li>üíù</li>
        <li>‚ù§Ô∏è</li> <li>üíñ</li> <li>ü§ç</li> <li>üíò</li> <li>üíù</li>
        <li>‚ù§Ô∏è</li> <li>üíñ</li> <li>ü§ç</li> <li>üíò</li> <li>üíù</li>
    </ul>
    <ul class="circles" id="bg-layer-2" style="display: none;"></ul>

    <div id="music-player" style="position: absolute; top: -9999px; left: -9999px; opacity: 0; pointer-events: none;"></div>

    <div class="phone-container">

        <div id="password-gate">
            <h2>üîí Top Secret Love</h2>
            <p>Enter the password to start.</p>
            <input type="password" id="password-input" placeholder="Enter Password">
            <br>
            <button class="unlock-btn" onclick="checkPassword()">Unlock</button>
            <p id="error-msg" style="color: #ff6b6b; font-size: 0.8em; display: none;">Wrong password!</p>
        </div>

        <div id="quiz-container">
            <div class="score-board">Score: <span id="score-val">0</span>/<span id="total-questions">4</span></div>
            <div class="card">
                <img id="question-image" style="display:none; max-width:100%; border-radius:10px; margin-bottom:15px; margin-left: auto; margin-right: auto;" src="" />
                
                <div class="question-text" id="question-text">Loading...</div>
                <div class="options" id="options-container"></div>
            </div>
        </div>

        <div id="proposal-container" style="display:none; flex-direction: column;">
            <div class="score-board">Score: <span id="proposal-score-val">0</span>/<span id="total-score">4</span></div> 
            <div class="card">
                <h2 id="proposal-question" style="margin-bottom: 20px;">Will you be my Valentine?</h2>
                <p id="no-message" style="min-height: 25px; font-weight: bold; color: #ff4b4b;"></p>

                <div class="btn-group">
                    <button class="yes-btn" id="yes-btn" onclick="handleProposal('yes')">Yes ‚ù§Ô∏è</button>
                    <button class="no-btn" id="no-btn" onclick="handleNoClick()">No</button>
                </div>
            </div>
        </div>

        <div id="success-container" style="display: none; flex-direction: column;">
            <div class="score-board">I am Yours, You are Mine</div>

            <div class="card">
                <h2>üéâ Yay! You're My Valentine! üéâ</h2>
                <p style="font-size: 40px; margin: 10px 0;">ü•Çü•∞</p>

                <p style="font-weight: bold; color: #555;">Thank you for making my day special! ‚ù§Ô∏è</p>
                <button class="restart-btn" onclick="restartQuiz()">Restart Quiz</button>
            </div>
        </div>

        <div id="system-error-overlay">
            <div style="font-size: 1.2em; margin-bottom: 5px;">‚ùå Invalid choice.</div>
            <div style="font-size: 0.9em; color: white;">System has detected you are already my Valentine.</div>
        </div>

    </div>

    <div id="heart-overlay" class="overlay-msg">
        <div class="heart-popup" id="success-icon">‚ù§Ô∏è</div>
        <h3 id="success-text">Correct!</h3>
    </div>

    <div id="hurt-overlay" class="overlay-msg">
        <div class="hurt-popup">üíî</div>
        <h3 id="fail-text">You hurt my feelings</h3>
    </div>

    <div id="heart-confetti"></div>
    
    <script>
        // --- GLOBAL VARIABLES ---
        let CORRECT_PASSWORD = "123"; 
        let MUSIC_ID = ""; 
        let player; 
        let currentScore = 0;
        let currentQuestionIndex = 0;

        let currentMood = 'normal'; // Track current mood so we don't reset it unnecessarily
        
        // Default Fallback Questions
        let questions = [
            {
                question: "When did I first fall for you?",
                options: ["Jan 29", "Feb 12", "Jan 28", "I Don't Remember"],
                correct: 0,
                failMsg: "You hurt my feelings ü•∫",
                successEmoji: "üíò",
                successMsg: "Aww, you remember! ü•∞"
            }
        ];



        // --- 1. STARTUP SEQUENCE ---
        window.onload = function() {
            // A. Decode the URL
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');

            if (encodedData) {
                try {
                    const decodedJson = decodeURIComponent(escape(atob(encodedData)));
                    const customConfig = JSON.parse(decodedJson);

                    if(customConfig.password) CORRECT_PASSWORD = customConfig.password;
                    if(customConfig.questions) questions = customConfig.questions;
                    
                    // LOAD MUSIC ID
                    if(customConfig.musicId) {
                        MUSIC_ID = customConfig.musicId;
                        console.log("Music ID Found:", MUSIC_ID);
                        // NOW load the YouTube Script (Only after we have the ID)
                        loadYoutubeScript();
                    }

                    // [NEW] Check for Custom Proposal Text
                    if(customConfig.proposalText && customConfig.proposalText.trim() !== "") {
                        document.getElementById('proposal-question').textContent = customConfig.proposalText;
                    }
                    
                } catch (e) {
                    console.error("Error loading data", e);
                }
            }
            
            // B. Update UI
            document.getElementById('total-questions').textContent = questions.length;
            document.getElementById('total-score').textContent = questions.length;
        };

        // --- YOUTUBE LOGIC ---
        function loadYoutubeScript() {
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // This function runs automatically when YouTube API is ready
        function onYouTubeIframeAPIReady() {
            if(MUSIC_ID) {
                player = new YT.Player('music-player', {
                    height: '1',
                    width: '1',
                    videoId: MUSIC_ID,
                    playerVars: {
                        'autoplay': 0, 
                        'controls': 0, 
                        'loop': 1, 
                        'playlist': MUSIC_ID, // Needed for loop to work
                        'playsinline': 1,
                        'enablejsapi': 1,
                        'origin': window.location.origin
                    },
                    events: {
                        'onReady': function(event) {
                            console.log("Player is ready!");
                            // Option to lower volume
                            event.target.setVolume(50);
                        },
                        'onError': function(e) {
                            console.error("Error loading YouTube video:", e.data);
                        }
                    }
                });
            }
        }

        // Function to Load Each Question
        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('proposal-score-val').textContent = currentScore;
                document.getElementById('proposal-container').style.display = 'flex';
                return;
            }

            const q = questions[currentQuestionIndex];
            document.getElementById('question-text').textContent = q.question;

            // Handle Image
            const imgEl = document.getElementById('question-image');
            if (q.imgUrl && q.imgUrl.trim() !== "") {
                imgEl.src = q.imgUrl;
                imgEl.style.display = 'block';
            } else {
                imgEl.style.display = 'none';
            }

            const optionsDiv = document.getElementById('options-container');
            optionsDiv.innerHTML = ''; 

            q.options.forEach((opt, index) => {
                const btn = document.createElement('div');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(index);
                optionsDiv.appendChild(btn);
            });
        }

        function handleAnswer(selectedIndex) {
            const q = questions[currentQuestionIndex];
            const isCorrect = (q.correct === -1) || (selectedIndex === q.correct);

            if (isCorrect) {
                currentScore++;
                document.getElementById('score-val').textContent = currentScore;
                
                const successText = q.successMsg || "Correct!";
                document.getElementById('success-text').textContent = successText;

                const successEmoji = q.successEmoji || "‚ù§Ô∏è";
                document.getElementById('success-icon').textContent = successEmoji;
                showFeedback('heart-overlay');
            } else {
                document.getElementById('fail-text').textContent = q.failMsg;
                showFeedback('hurt-overlay');
            }
        }

        function showFeedback(elementId) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
                currentQuestionIndex++;
                loadQuestion();
            }, 2000); 
        }

        //Message pool
        const noMessages = [
            "I see you press No üò§",
            "Hey Stop it!",
            "Just Say Yes already...",
            "I know you wanna say yes üòâ",
            "I wanna cry üò≠",
            "You are breaking my heart üíî",
            "Okay, now I'm mad üò†",
            "Pretty please? ü•∫",
            "Ouch! That hurts! üò¢",
            "Are you sure? I thought we had something special! ü•∫",
            "I guess I'll just cry in the corner... üò≠",
            "Well, that wasn't very nice... üòî",
            "I thought we were a match made in heaven! üíî",
            "You broke my heart into pieces! üíî",
            "I can't believe you said no... üò¢",
            "I thought we were meant to be! ü•∫",
            "That stings more than I expected... üò≠"
        ];

        let messageIndex = 0;
        
        // Define your two "Moods" (Mix of emojis and text)
        const moods = {
            happy: ['‚ù§Ô∏è', 'üíñ', 'I‚ù§Ô∏èU', 'Love You', 'ü•∞', 'Forever', 'You&Me', 'üíò', 'üíï', 'ü´Ç', 'ü§ó'],
            sad: ['üíî', 'üò¢', 'üòî', 'üòü', '‚òπÔ∏è', 'ü•∫', 'ü•π', 'üòì', 'üòû', 'üòñ', 'üò≠', 'üò¢', 'üò•', 'ü•Ä']
        };

        function setMood(moodType) {
            //Update the state
            currentMood = moodType;

            // Hide Layer 1 (Giants) & Show Layer 2 (Moods)
            document.getElementById('bg-layer-1').style.display = 'none';

            // Show Mood layer 
            const layer2 = document.getElementById('bg-layer-2');
            layer2.style.display = 'block';
            layer2.innerHTML = ''; // Clear previous mood

            // Generate Floating Text/Emojis
            const items = moods[moodType];
            for(let i = 0; i < 20; i++) {
                const li = document.createElement('li');
                li.textContent = items[Math.floor(Math.random() * items.length)];

                // Randomize position, size, and animation for each item
                li.style.left = Math.random() * 90 + '%';
                li.style.fontSize = (20 + Math.random() * 30) + 'px'; // Smaller text size
                li.style.animationDelay = (Math.random() * 5) + 's';
                li.style.animationDuration = (10 + Math.random() * 10) + 's';
                layer2.appendChild(li);
            }
        }

        // Check Password and Start Quiz
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if(input === CORRECT_PASSWORD) {
                document.getElementById('password-gate').style.display = 'none';
                
                // TRIGGER MUSIC HERE
                if(player && typeof player.playVideo === 'function') {
                    player.playVideo();
                    player.setVolume(50);
                    console.log("Playing Music...");
                } else {
                    console.log("Player not ready yet.");
                }

                document.getElementById('quiz-container').style.display = 'flex';
                loadQuestion();
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        // Handle "No" Click (Triggers Sadness)
        function handleNoClick() {

            //Check is we are already sad to avoid resetting the mood and message
            if(currentMood !== 'sad'){
                setMood('sad');
            }
            
            // Shake the screen for effect
            const noBtn = document.getElementById('no-btn');
            const card = document.querySelector('#proposal-container .card');

            const maxX = card.clientWidth - noBtn.offsetWidth;
            const maxY = card.clientHeight - noBtn.offsetHeight;

            noBtn.style.position = 'absolute';
            noBtn.style.left = Math.floor(Math.random() * maxX) + 'px';
            noBtn.style.top = Math.floor(Math.random() * maxY) + 'px';
            card.style.animation = "shake 0.5s ease";
            
            // Reset animation so it can shake again
            setTimeout(() => { card.style.animation = ""; }, 500);
        }

        // Function to Handle Yes Answer to Proposal
        function handleProposal(answer) {
            if (answer === 'yes') {
                document.getElementById('proposal-container').style.display = 'none';
                document.getElementById('success-container').style.display = 'flex';

                setMood('happy'); // Restore the love
                // Trigger the heart confetti for extra celebration!
                launchHeartConfetti();
            } else {
                const errorPopup = document.getElementById('system-error-overlay');
                errorPopup.style.display = 'block';
                setTimeout(() => {
                    errorPopup.style.display = 'none';
                }, 3000);
            }
        }

        //Function to Restart the Game (Can be called from Success Screen)
        function restartQuiz() {
            // 1. Reset Variables
            currentScore = 0;
            currentQuestionIndex = 0;
            
            // 2. Reset Text Counters in the UI
            document.getElementById('score-val').textContent = '0';
            document.getElementById('proposal-score-val').textContent = '0';

            // 3. Flip the Screens
            document.getElementById('success-container').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'flex';

            // 4. Reset the Mood to "Giant Hearts" (Layer 1)
            // This makes it feel like the start of the app again
            document.getElementById('bg-layer-2').style.display = 'none'; // Hide text
            document.getElementById('bg-layer-1').style.display = 'block'; // Show Giants

            // 5. Load Question 1
            loadQuestion();

            // NOTE: We do NOT touch 'player'. The music keeps playing! üéµ
        }

        // Functions to Launch Heart Confetti
        function launchHeartConfetti() {
            const confetti = document.getElementById('heart-confetti');
            const count = 25; 
            const burstIntervalMs = 350;
            const hearts = ['‚ù§Ô∏è', 'üíñ', 'üíò', 'üíï', 'üåπ', 'ü•Ä', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üíê'];

            function spawnHeart(i) {
                const heart = document.createElement('div');
                heart.className = 'confetti-heart';
                heart.textContent = hearts[i % hearts.length];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = (Math.random() * 0.8).toFixed(2) + 's';
                heart.style.animationDuration = (5 + Math.random() * 3).toFixed(2) + 's';
                heart.style.fontSize = (18 + Math.random() * 16) + 'px';
                confetti.appendChild(heart);

                setTimeout(() => { heart.remove(); }, 9000);
            }

            for (let i = 0; i < count; i++) spawnHeart(i);

            let i = count;
            const intervalId = setInterval(() => {
                spawnHeart(i);
                i += 1;
            }, burstIntervalMs);

            setTimeout(() => { clearInterval(intervalId); }, 12000);
        }

    </script>
</body>
</html>